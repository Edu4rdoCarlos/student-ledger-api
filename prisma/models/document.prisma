// ============================================
// DOCUMENTO (Ata, Ficha)
// ============================================

model Document {
  id                     String         @id @default(uuid())
  tipo                   DocumentType
  versao                 Int            @default(1)
  documentoHash          String         @db.VarChar(64) // SHA-256
  arquivoPath            String? // Caminho para download
  status                 DocumentStatus @default(PENDENTE)
  motivoAlteracao        String? // Motivo da nova versao
  motivoInativacao       String?
  dataInativacao         DateTime?
  blockchainTxId         String?
  blockchainRegisteredAt DateTime?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  // Relacionamentos
  defenseId         String
  defense           Defense    @relation(fields: [defenseId], references: [id])
  previousVersionId String?    @unique
  previousVersion   Document?  @relation("DocumentVersions", fields: [previousVersionId], references: [id])
  nextVersion       Document?  @relation("DocumentVersions")
  approvals         Approval[]

  @@unique([defenseId, tipo, versao])
  @@index([defenseId])
  @@index([documentoHash])
  @@index([status])
}

enum DocumentType {
  ATA
  FICHA
}

enum DocumentStatus {
  PENDENTE
  APROVADO
  INATIVO
}
