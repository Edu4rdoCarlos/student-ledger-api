model Defense {
  id          String        @id @default(uuid())
  title       String
  defenseDate DateTime
  location    String?
  finalGrade  Float?
  result      DefenseResult @default(PENDING)
  status      DefenseStatus @default(SCHEDULED)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  advisorId String
  advisor      Advisor          @relation(fields: [advisorId], references: [id])
  students     DefenseStudent[]
  documents    Document[]
  examBoard    ExamBoardMember[]
  events       DefenseEvent[]

  @@index([advisorId])
  @@index([result])
  @@index([status])
}

model DefenseStudent {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  defenseId String
  defense   Defense @relation(fields: [defenseId], references: [id], onDelete: Cascade)
  studentId String
  student   Student @relation(fields: [studentId], references: [id])

  @@unique([defenseId, studentId])
  @@index([defenseId])
  @@index([studentId])
}

model ExamBoardMember {
  id        String   @id @default(uuid())
  name      String
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  defenseId String
  defense   Defense @relation(fields: [defenseId], references: [id], onDelete: Cascade)

  @@index([defenseId])
  @@index([email])
}

model DefenseEvent {
  id        String            @id @default(uuid())
  type      DefenseEventType
  reason    String
  metadata  Json?
  createdAt DateTime          @default(now())

  defenseId String
  defense   Defense @relation(fields: [defenseId], references: [id], onDelete: Cascade)

  @@index([defenseId])
  @@index([type])
}

enum DefenseResult {
  PENDING
  APPROVED
  FAILED
}

enum DefenseStatus {
  SCHEDULED
  CANCELED
  COMPLETED
}

enum DefenseEventType {
  CANCELED
  RESCHEDULED
}
