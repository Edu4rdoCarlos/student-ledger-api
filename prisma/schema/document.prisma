model Document {
  id                     String         @id @default(uuid())
  type                   DocumentType
  version                Int            @default(1)
  documentHash           String?        @db.VarChar(64) // IPFS CID (content-addressed hash) - filled when submitted to IPFS

  // Storage reference
  mongoFileId            String?        // GridFS file ID (primary storage, IPFS as fallback using documentHash)

  status                 DocumentStatus @default(PENDING)
  changeReason           String?        // Reason for new version
  inactivationReason     String?
  inactivatedAt          DateTime?
  blockchainTxId         String?
  blockchainRegisteredAt DateTime?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  defenseId         String
  defense           Defense    @relation(fields: [defenseId], references: [id])
  previousVersionId String?    @unique
  previousVersion   Document?  @relation("DocumentVersions", fields: [previousVersionId], references: [id])
  nextVersion       Document?  @relation("DocumentVersions")
  approvals         Approval[]

  @@unique([defenseId, type, version])
  @@index([defenseId])
  @@index([documentHash])
  @@index([status])
}

enum DocumentType {
  ATA
  FICHA
}

enum DocumentStatus {
  PENDING
  APPROVED
  INACTIVE
}
